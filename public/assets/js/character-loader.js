(()=>{var n=class{constructor(e={}){this.baseUrl=e.baseUrl||"https://projectcontext.org",this.filterGender=e.filterGender||null,this.manifest=null,this.cache=new Map,this.initialized=!1}async initialize(){if(this.initialized)return this.manifest;try{let e=await fetch(`${this.baseUrl}/assets/data/manifest.json`);if(!e.ok)throw new Error(`Failed to load manifest: ${e.status}`);return this.manifest=await e.json(),this.initialized=!0,this.manifest}catch(e){return console.error("Error loading manifest:",e),this.getFallbackManifest()}}getFallbackManifest(){return{version:"1.0",lastUpdated:new Date().toISOString(),totalCharacters:300,books:{tanakh:{torah:["genesis","exodus","leviticus","numbers","deuteronomy"],neviim:["joshua","judges","samuel","kings","isaiah","jeremiah","ezekiel"],ketuvim:["psalms","proverbs","job","ruth","esther","daniel","chronicles"]},newTestament:{gospels:["matthew","mark","luke","john"],history:["acts"],epistles:["romans","corinthians","galatians"],prophecy:["revelation"]}}}}async loadBook(e){if(this.cache.has(e))return this.filterData(this.cache.get(e));try{let a=await fetch(`${this.baseUrl}/assets/data/books/${e}.json`);if(!a.ok)throw new Error(`Failed to load book ${e}: ${a.status}`);let s=await a.text(),t;try{t=JSON.parse(s)}catch(r){throw console.error(`JSON parse error in ${e}.json:`,r),console.error("JSON parse error details:",{bookId:e,errorMessage:r.message,errorPosition:r.message.match(/position (\d+)/)?r.message.match(/position (\d+)/)[1]:"unknown"}),s.length>0&&(console.error("First 500 characters of JSON:",s.substring(0,500)),console.error("Last 500 characters of JSON:",s.substring(Math.max(0,s.length-500)))),new Error(`Invalid JSON in ${e}.json: ${r.message}`)}if(!t||typeof t!="object")throw new Error(`Invalid data structure in ${e}.json`);return(!t.book||!Array.isArray(t.characters))&&console.warn(`Unexpected data structure in ${e}.json:`,{hasBook:!!t.book,hasCharacters:!!t.characters,charactersIsArray:Array.isArray(t.characters)}),this.cache.set(e,t),console.log(`Successfully loaded ${e}.json with ${t.characters?.length||0} characters`),this.filterData(t)}catch(a){return console.error(`Error loading book ${e}:`,a),(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&console.warn(`Debug mode: Failed to load ${e}.json. Check console for details.`),this.getFallbackBookData(e)}}async validateAllBooks(){let e=this.getAllBookIds(),a={valid:[],invalid:[],missing:[]};for(let s of e)try{let t=await fetch(`${this.baseUrl}/assets/data/books/${s}.json`);if(!t.ok){a.missing.push(s);continue}let r=await t.text();try{let o=JSON.parse(r);o.book&&Array.isArray(o.characters)?a.valid.push({bookId:s,characterCount:o.characters.length,femaleCount:o.characters.filter(i=>i.gender==="female").length,maleCount:o.characters.filter(i=>i.gender==="male").length}):a.invalid.push({bookId:s,reason:"Invalid structure"})}catch(o){a.invalid.push({bookId:s,reason:o.message})}}catch{a.missing.push(s)}return console.table(a.valid),a.invalid.length>0&&console.error("Invalid JSON files:",a.invalid),a.missing.length>0&&console.warn("Missing JSON files:",a.missing),a}filterData(e){return!this.filterGender||!e.characters?e:{...e,characters:e.characters.filter(a=>a.gender===this.filterGender)}}async getAllCharacters(){this.manifest||await this.initialize();let e=[],a=this.getAllBookIds();for(let s of a)try{let t=await this.loadBook(s);t.characters&&e.push(...t.characters.map(r=>({...r,book:t.book})))}catch(t){console.error(`Failed to load ${s}:`,t)}return e}getAllBookIds(){let e=[];return this.manifest?.books&&(this.manifest.books.tanakh&&Object.values(this.manifest.books.tanakh).forEach(a=>{Array.isArray(a)&&e.push(...a)}),this.manifest.books.newTestament&&Object.values(this.manifest.books.newTestament).forEach(a=>{Array.isArray(a)&&e.push(...a)})),e}async searchCharacters(e){let a=await this.getAllCharacters(),s=e.toLowerCase();return a.filter(t=>t.name?.toLowerCase().includes(s)||t.hebrew?.includes(e)||t.greek?.includes(e)||t.meaning?.toLowerCase().includes(s)||t.summary?.toLowerCase().includes(s)||t.tags?.some(r=>r.toLowerCase().includes(s)))}async getFeaturedCharacters(e=6){let a=[{book:"genesis",id:"abraham"},{book:"genesis",id:"sarah"},{book:"exodus",id:"moses"},{book:"judges",id:"deborah"},{book:"genesis",id:"hagar"},{book:"judges",id:"delilah"}],s=[];for(let t of a.slice(0,e))try{let r=await this.loadBook(t.book),o=r.characters?.find(i=>i.id===t.id);o&&s.push({...o,book:r.book})}catch(r){console.error(`Failed to load featured character ${t.id}:`,r)}return s}async getStatistics(){this.manifest||await this.initialize();let e={totalCharacters:0,totalBooks:0,byGender:{male:0,female:0,unknown:0},byTestament:{tanakh:0,newTestament:0}},a=this.getAllBookIds();e.totalBooks=a.length;for(let s of a)try{let t=await this.loadBook(s);t.characters&&(e.totalCharacters+=t.characters.length,t.characters.forEach(r=>{let o=r.gender||"unknown";e.byGender[o]=(e.byGender[o]||0)+1;let i=this.getTestament(s);i&&e.byTestament[i]++}))}catch(t){console.error(`Failed to get stats for ${s}:`,t)}return e}getTestament(e){if(!this.manifest?.books)return null;if(this.manifest.books.tanakh){for(let a of Object.values(this.manifest.books.tanakh))if(Array.isArray(a)&&a.includes(e))return"tanakh"}if(this.manifest.books.newTestament){for(let a of Object.values(this.manifest.books.newTestament))if(Array.isArray(a)&&a.includes(e))return"newTestament"}return null}getFallbackBookData(e){return{genesis:{book:{id:"genesis",name:"Genesis",hebrew:"\u05D1\u05B0\u05BC\u05E8\u05B5\u05D0\u05E9\u05B4\u05C1\u05D9\u05EA",characterCount:30},characters:[{id:"abraham",name:"Abraham",hebrew:"\u05D0\u05B7\u05D1\u05B0\u05E8\u05B8\u05D4\u05B8\u05DD",gender:"male",profilePath:"/studies/characters/genesis/abraham.html",references:["Gen 11-25"],summary:"Father of faith and patriarch of Israel",tags:["Patriarch","Covenant"]},{id:"sarah",name:"Sarah",hebrew:"\u05E9\u05B8\u05C2\u05E8\u05B8\u05D4",gender:"female",profilePath:"/studies/characters/genesis/sarah.html",references:["Gen 11-25"],summary:"Mother of nations, wife of Abraham",tags:["Matriarch"]}]},exodus:{book:{id:"exodus",name:"Exodus",hebrew:"\u05E9\u05B0\u05C1\u05DE\u05D5\u05B9\u05EA",characterCount:15},characters:[{id:"moses",name:"Moses",hebrew:"\u05DE\u05B9\u05E9\u05B6\u05C1\u05D4",gender:"male",profilePath:"/studies/characters/exodus/moses.html",references:["Exodus-Deuteronomy"],summary:"Prophet, lawgiver, and deliverer of Israel",tags:["Prophet","Leader"]},{id:"miriam",name:"Miriam",hebrew:"\u05DE\u05B4\u05E8\u05B0\u05D9\u05B8\u05DD",gender:"female",profilePath:"/studies/characters/exodus/miriam.html",references:["Ex 2, 15"],summary:"Prophetess and sister of Moses",tags:["Prophetess"]}]}}[e]||{book:{id:e,name:e.charAt(0).toUpperCase()+e.slice(1),characterCount:0},characters:[]}}clearCache(){this.cache.clear()}async preloadBooks(e){let a=e.map(s=>this.loadBook(s));await Promise.all(a)}},h=n;})();
//# sourceMappingURL=character-loader.js.map
