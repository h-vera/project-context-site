var search_module=(()=>{class u{constructor(e={}){this.config={debounceDelay:300,maxResults:50,cacheLimit:20,...e},this.currentQuery="",this.isSearching=!1,this.cache=new Map,this.init()}async init(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>this.setupUI()):this.setupUI()}setupUI(){const e=document.getElementById("searchInput"),t=document.getElementById("searchButton")||document.querySelector(".search-button"),s=document.getElementById("clearSearch")||document.querySelector(".clear-search");if(!e)return;const i=this.debounce(()=>this.performSearch(),this.config.debounceDelay);e.addEventListener("input",n=>{const r=n.target.value.trim();s&&(s.style.display=r?"flex":"none"),r.length>=2?i():r.length===0&&this.clearResults()}),t&&t.addEventListener("click",()=>this.performSearch()),e.addEventListener("keypress",n=>{n.key==="Enter"&&(n.preventDefault(),this.performSearch())}),s&&s.addEventListener("click",()=>{e.value="",s.style.display="none",this.clearResults(),e.focus()})}async performSearch(){const t=document.getElementById("searchInput")?.value.trim().toLowerCase();if(!t||t.length<2||this.currentQuery===t||this.isSearching)return;this.currentQuery=t,this.isSearching=!0;const s=document.getElementById("searchResults"),i=document.getElementById("searchResultsCount");s&&(s.innerHTML=`
                <div class="search-loading">
                    <div class="loading-spinner"></div>
                    <p>Searching...</p>
                </div>
            `);try{const n=`search_${t}`;let r=this.cache.get(n);r||(window.hub&&window.hub.loader?r=await window.hub.loader.searchCharacters(t):window.hub&&window.hub.searchCharacters?r=await window.hub.searchCharacters(t):r=this.searchDOM(t),this.cacheResults(n,r)),this.displayResults(r,t,s,i)}catch(n){console.error("Search error:",n),this.displayError(s,"Search failed. Please try again.")}finally{this.isSearching=!1}}displayResults(e,t,s,i){if(!s)return;if(!e||e.length===0){s.innerHTML=`
                <div class="empty-state">
                    <div class="empty-state-icon">\u{1F50D}</div>
                    <div class="empty-state-text">No Results Found</div>
                    <div class="empty-state-subtext">Try different keywords</div>
                </div>
            `,i&&(i.style.display="none");return}if(i){const a=i.querySelector(".results-number");a&&(a.textContent=e.length),i.style.display="block"}const n=e.slice(0,this.config.maxResults);let r=`
            <div class="section-header">
                <h3 class="section-title">Search Results</h3>
                <p class="section-subtitle">${e.length} result${e.length!==1?"s":""} for "${this.escapeHtml(t)}"</p>
            </div>
            <div class="search-results-grid studies-list cards-grid">
        `;n.forEach(a=>{r+=this.createResultCard(a,t)}),r+="</div>",s.innerHTML=r,setTimeout(()=>{s.scrollIntoView({behavior:"smooth",block:"nearest"})},100)}createResultCard(e,t){const s=e.name||"Unknown",i=e.book?.id||"unknown",n=e.profilePath||e.href||"#",r=e.hebrew?`<span class="hebrew">${e.hebrew}</span>`:"";let a="";e.tags&&Array.isArray(e.tags)&&(a=e.tags.map(h=>`<span class="tag ${this.getTagClass(h)}">${this.escapeHtml(h)}</span>`).join(""));const o=Array.isArray(e.references)?e.references.join(", "):e.references||"",l=e.meaning?`${e.meaning} \u2022 ${o}`:o,m=this.highlightText(s,t),d=this.highlightText(e.summary||e.description||"",t);return`
            <article class="study-card">
                <a href="${n}" class="study-card-link">
                    <div class="study-card-header">
                        <h4 class="study-card-title">
                            ${m} ${r}
                        </h4>
                        ${a?`<div class="study-card-tags">${a}</div>`:""}
                    </div>
                    <div class="study-card-body">
                        ${l?`<p class="study-card-meta">${this.escapeHtml(l)}</p>`:""}
                        ${d?`<p class="study-card-desc">${d}</p>`:""}
                        ${e.book?.name?`<p class="study-card-meta"><strong>Book:</strong> ${e.book.name}</p>`:""}
                    </div>
                    <div class="study-card-arrow">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                            <path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" fill="none"/>
                        </svg>
                    </div>
                </a>
            </article>
        `}searchDOM(e){const t=[];return document.querySelectorAll(".study-card, .character-card, .featured-card, .woman-card").forEach(i=>{const n=i.textContent.toLowerCase();if(n.includes(e)){const r=i.querySelector(".study-card-title, .character-name, .featured-card-title, .woman-card-name"),a=i.querySelector(".study-card-desc, .character-desc, .featured-card-desc, .woman-card-desc"),o=i.querySelector("a");r&&t.push({name:r.textContent.trim(),summary:a?.textContent.trim()||"",profilePath:o?.href||"#",book:{name:"Current Page"},relevance:this.calculateRelevance(n,e)})}}),t.sort((i,n)=>(n.relevance||0)-(i.relevance||0))}calculateRelevance(e,t){let s=0;const i=e.toLowerCase(),n=t.toLowerCase();i===n&&(s+=100),i.startsWith(n)&&(s+=50),i.includes(n)&&(s+=25);try{new RegExp(`\\b${this.escapeRegex(n)}\\b`,"i").test(e)&&(s+=30)}catch{}return s}highlightText(e,t){if(!t||!e)return this.escapeHtml(e);try{const s=new RegExp(`(${this.escapeRegex(t)})`,"gi");return this.escapeHtml(e).replace(s,'<mark class="search-highlight">$1</mark>')}catch{return this.escapeHtml(e)}}getTagClass(e){const t=e.toLowerCase();return t.includes("group")||t.includes("unnamed")?"group":t.includes("warning")||t.includes("antagonist")?"warning":""}displayError(e,t="Search error occurred"){e&&(e.innerHTML=`
                <div class="empty-state">
                    <div class="empty-state-icon">\u26A0\uFE0F</div>
                    <div class="empty-state-text">Error</div>
                    <div class="empty-state-subtext">${this.escapeHtml(t)}</div>
                </div>
            `)}clearResults(){const e=document.getElementById("searchResults"),t=document.getElementById("searchResultsCount");e&&(e.innerHTML=""),t&&(t.style.display="none"),this.currentQuery=""}cacheResults(e,t){if(this.cache.size>=this.config.cacheLimit){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}debounce(e,t){let s;return function(...n){const r=()=>{clearTimeout(s),e(...n)};clearTimeout(s),s=setTimeout(r,t)}}escapeHtml(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}if(typeof window<"u"){let e=function(){c||(c=new u,window.searchCore=c,console.log("\u2713 Search Core initialized (optimized version)"))};var p=e;let c;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}typeof window<"u"&&(window.SearchCore=u);})();
//# sourceMappingURL=search-module.min.js.map
